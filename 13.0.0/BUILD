# LLVM 13.0.0.
package(default_visibility = ["//visibility:public"])

licenses(["notice"])

cc_library(
    name = "13.0.0",
    data = select({
        "//:darwin": ["@clang-llvm-13.0.0-x86_64-apple-darwin//:libdir"],
        "//conditions:default": [
            "@clang-llvm-13.0.0-x86_64-linux-gnu-ubuntu-20.04//:libdir",
        ],
    }),
    defines = [
        "__STDC_CONSTANT_MACROS",
        "__STDC_LIMIT_MACROS",
    ],
    linkopts = select({
        # llvm-config --ldflags
        "//:darwin": [
            "-Wl,-rpath,$(location @clang-llvm-13.0.0-x86_64-apple-darwin//:libdir)/",
            "-L$(location @clang-llvm-13.0.0-x86_64-apple-darwin//:libdir)/",
            "-Wl,-search_paths_first",
            "-Wl,-headerpad_max_install_names",
        ],
        "//conditions:default": [
            "-Wl,-rpath,$(location @clang-llvm-13.0.0-x86_64-linux-gnu-ubuntu-20.04//:libdir)/",
            "-L$(location @clang-llvm-13.0.0-x86_64-linux-gnu-ubuntu-20.04//:libdir)/",
        ],
    }) + select({
        # llvm-config --system-libs
        "//:darwin": [
            "-lz",
            "-lcurses",
            "-lm",
            "-lxml2",
        ],
        "//conditions:default": [
            "-lrt",
            "-ldl",
            "-ltinfo",
            "-lpthread",
            "-lm",
            "-lz"
        ],
    }) + [
       # clang libs
        "-lclangARCMigrate",
        "-lclangFrontend",
        "-lclangFrontendTool",
        "-lclangDriver",
        "-lclangSerialization",
        "-lclangCodeGen",
        "-lclangParse",
        "-lclangSema",
        "-lclangRewriteFrontend",
        "-lclangRewrite",
        "-lclangStaticAnalyzerFrontend",
        "-lclangStaticAnalyzerCheckers",
        "-lclangStaticAnalyzerCore",
        "-lclangAnalysis",
        "-lclangEdit",
        "-lclangAST",
        "-lclangASTMatchers",
        "-lclangLex",
        "-lclangBasic",
        "-lclangTooling",
        "-lclangToolingCore",
        # llvm-config --libs
        "-lLLVMWindowsManifest",
        "-lLLVMXRay",
        "-lLLVMLibDriver",
        "-lLLVMDlltoolDriver",
        "-lLLVMCoverage",
        "-lLLVMLineEditor",
        "-lLLVMXCoreDisassembler",
        "-lLLVMXCoreCodeGen",
        "-lLLVMXCoreDesc",
        "-lLLVMXCoreInfo",
        "-lLLVMX86Disassembler",
        "-lLLVMX86AsmParser",
        "-lLLVMX86CodeGen",
        "-lLLVMX86Desc",
        "-lLLVMX86Info",
        "-lLLVMWebAssemblyDisassembler",
        "-lLLVMWebAssemblyAsmParser",
        "-lLLVMWebAssemblyCodeGen",
        "-lLLVMWebAssemblyDesc",
        "-lLLVMWebAssemblyUtils",
        "-lLLVMWebAssemblyInfo",
        "-lLLVMSystemZDisassembler",
        "-lLLVMSystemZAsmParser",
        "-lLLVMSystemZCodeGen",
        "-lLLVMSystemZDesc",
        "-lLLVMSystemZInfo",
        "-lLLVMSparcDisassembler",
        "-lLLVMSparcAsmParser",
        "-lLLVMSparcCodeGen",
        "-lLLVMSparcDesc",
        "-lLLVMSparcInfo",
        "-lLLVMRISCVDisassembler",
        "-lLLVMRISCVAsmParser",
        "-lLLVMRISCVCodeGen",
        "-lLLVMRISCVDesc",
        "-lLLVMRISCVInfo",
        "-lLLVMPowerPCDisassembler",
        "-lLLVMPowerPCAsmParser",
        "-lLLVMPowerPCCodeGen",
        "-lLLVMPowerPCDesc",
        "-lLLVMPowerPCInfo",
        "-lLLVMNVPTXCodeGen",
        "-lLLVMNVPTXDesc",
        "-lLLVMNVPTXInfo",
        "-lLLVMMSP430Disassembler",
        "-lLLVMMSP430AsmParser",
        "-lLLVMMSP430CodeGen",
        "-lLLVMMSP430Desc",
        "-lLLVMMSP430Info",
        "-lLLVMMipsDisassembler",
        "-lLLVMMipsAsmParser",
        "-lLLVMMipsCodeGen",
        "-lLLVMMipsDesc",
        "-lLLVMMipsInfo",
        "-lLLVMLanaiDisassembler",
        "-lLLVMLanaiCodeGen",
        "-lLLVMLanaiAsmParser",
        "-lLLVMLanaiDesc",
        "-lLLVMLanaiInfo",
        "-lLLVMHexagonDisassembler",
        "-lLLVMHexagonCodeGen",
        "-lLLVMHexagonAsmParser",
        "-lLLVMHexagonDesc",
        "-lLLVMHexagonInfo",
        "-lLLVMBPFDisassembler",
        "-lLLVMBPFAsmParser",
        "-lLLVMBPFCodeGen",
        "-lLLVMBPFDesc",
        "-lLLVMBPFInfo",
        "-lLLVMAVRDisassembler",
        "-lLLVMAVRAsmParser",
        "-lLLVMAVRCodeGen",
        "-lLLVMAVRDesc",
        "-lLLVMAVRInfo",
        "-lLLVMARMDisassembler",
        "-lLLVMARMAsmParser",
        "-lLLVMARMCodeGen",
        "-lLLVMARMDesc",
        "-lLLVMARMUtils",
        "-lLLVMARMInfo",
        "-lLLVMAMDGPUDisassembler",
        "-lLLVMAMDGPUAsmParser",
        "-lLLVMAMDGPUCodeGen",
        "-lLLVMAMDGPUDesc",
        "-lLLVMAMDGPUUtils",
        "-lLLVMAMDGPUInfo",
        "-lLLVMAArch64Disassembler",
        "-lLLVMAArch64AsmParser",
        "-lLLVMAArch64CodeGen",
        "-lLLVMAArch64Desc",
        "-lLLVMAArch64Utils",
        "-lLLVMAArch64Info",
        "-lLLVMOrcJIT",
        "-lLLVMMCJIT",
        "-lLLVMJITLink",
        "-lLLVMInterpreter",
        "-lLLVMExecutionEngine",
        "-lLLVMRuntimeDyld",
        "-lLLVMOrcTargetProcess",
        "-lLLVMOrcShared",
        "-lLLVMDWP",
        "-lLLVMSymbolize",
        "-lLLVMDebugInfoPDB",
        "-lLLVMDebugInfoGSYM",
        "-lLLVMOption",
        "-lLLVMObjectYAML",
        "-lLLVMMCA",
        "-lLLVMMCDisassembler",
        "-lLLVMLTO",
        "-lLLVMCFGuard",
        "-lLLVMFrontendOpenACC",
        "-lLLVMExtensions",
        "-lPolly",
        "-lPollyISL",
        "-lLLVMPasses",
        "-lLLVMObjCARCOpts",
        "-lLLVMCoroutines",
        "-lLLVMipo",
        "-lLLVMInstrumentation",
        "-lLLVMVectorize",
        "-lLLVMLinker",
        "-lLLVMFrontendOpenMP",
        "-lLLVMDWARFLinker",
        "-lLLVMGlobalISel",
        "-lLLVMMIRParser",
        "-lLLVMAsmPrinter",
        "-lLLVMDebugInfoMSF",
        "-lLLVMDebugInfoDWARF",
        "-lLLVMSelectionDAG",
        "-lLLVMCodeGen",
        "-lLLVMIRReader",
        "-lLLVMAsmParser",
        "-lLLVMInterfaceStub",
        "-lLLVMFileCheck",
        "-lLLVMFuzzMutate",
        "-lLLVMTarget",
        "-lLLVMScalarOpts",
        "-lLLVMInstCombine",
        "-lLLVMAggressiveInstCombine",
        "-lLLVMTransformUtils",
        "-lLLVMBitWriter",
        "-lLLVMAnalysis",
        "-lLLVMProfileData",
        "-lLLVMObject",
        "-lLLVMTextAPI",
        "-lLLVMMCParser",
        "-lLLVMMC",
        "-lLLVMDebugInfoCodeView",
        "-lLLVMBitReader",
        "-lLLVMCore",
        "-lLLVMRemarks",
        "-lLLVMBitstreamReader",
        "-lLLVMBinaryFormat",
        "-lLLVMTableGen",
        "-lLLVMSupport",
        "-lLLVMDemangle",
    ],
    deps = select({
        "//:darwin": [
            "@clang-llvm-13.0.0-x86_64-apple-darwin//:headers",
            "@clang-llvm-13.0.0-x86_64-apple-darwin//:libs",
        ],
        "//conditions:default": [
            "@clang-llvm-13.0.0-x86_64-linux-gnu-ubuntu-20.04//:headers",
            "@clang-llvm-13.0.0-x86_64-linux-gnu-ubuntu-20.04//:static_libs",
            "@clang-llvm-13.0.0-x86_64-linux-gnu-ubuntu-20.04//:LLVMPolly",
        ],
    }),
)


genrule(
    name = "make_clang",
    srcs = select({
        "//:darwin": ["@clang-llvm-13.0.0-x86_64-apple-darwin//:clang"],
        "//conditions:default": ["@clang-llvm-13.0.0-x86_64-linux-gnu-ubuntu-20.04//:clang"],
    }),
    outs = ["clang"],
    cmd = "cp $< $@ && chmod +x $@",
)

genrule(
    name = "make_clang++",
    srcs = select({
        "//:darwin": ["@clang-llvm-13.0.0-x86_64-apple-darwin//:clang++"],
        "//conditions:default": ["@clang-llvm-13.0.0-x86_64-linux-gnu-ubuntu-20.04//:clang++"],
    }),
    outs = ["clang++"],
    cmd = "cp $< $@ && chmod +x $@",
)

genrule(
    name = "make_opt",
    srcs = select({
        "//:darwin": ["@clang-llvm-13.0.0-x86_64-apple-darwin//:opt"],
        "//conditions:default": ["@clang-llvm-13.0.0-x86_64-linux-gnu-ubuntu-20.04//:opt"],
    }),
    outs = ["opt"],
    cmd = "cp $< $@ && chmod +x $@",
)
